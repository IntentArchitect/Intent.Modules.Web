<div class="pa-4">
  <mat-card class="mb-4 ux-gradient-primary" appearance="outlined">
    <mat-card-content class="pa-4">
      <div class="header-content">
        <div class="title-row">
          <mat-icon class="mr-2">person_search</mat-icon>
          <span class="mat-headline-5 text-white font-weight-bold">Customer Search</span>
        </div>
        <div class="subtitle-row text-white opacity-90">
          Search and explore your customer list.
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <mat-card class="ux-fade-in-up" style="animation-delay: 0.1s">
    <mat-card-header>
      <mat-card-title>Customers</mat-card-title>
    </mat-card-header>

    <mat-card-content>
      <div class="filter-grid">
        <div class="filter-item">
          <mat-form-field appearance="outline" class="w-100 mb-4">
            <mat-label>Search</mat-label>
            <input
              matInput
              placeholder="Search by name, surname or email"
              [(ngModel)]="searchTerm"
              (keyup.enter)="onSearch()" />
            <button mat-icon-button matSuffix (click)="onSearch()">
              <mat-icon>search</mat-icon>
            </button>
          </mat-form-field>
        </div>

        <div class="filter-item">
          <mat-form-field appearance="outline" class="w-100 mb-4">
            <mat-label>Active status</mat-label>
            <mat-select [(ngModel)]="isActiveFilter">
              <mat-option [value]="null">All</mat-option>
              <mat-option [value]="true">Active</mat-option>
              <mat-option [value]="false">Inactive</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </div>

      <div class="button-row mb-4">
        <button mat-raised-button color="primary" (click)="onSearch()" class="mr-2">
          <mat-icon class="mr-1">search</mat-icon>
          Search
        </button>

        <button mat-raised-button color="accent" (click)="navigateToCustomerAdd()">
          <mat-icon class="mr-1">add</mat-icon>
          Add Customer
        </button>
      </div>

      <div *ngIf="serviceErrors.loadCustomersError" class="error-message mb-4">
        {{ serviceErrors.loadCustomersError }}
      </div>

      <div class="table-wrapper">
        <div class="table-container" [class.loading]="isLoading">
          <table
            mat-table
            [dataSource]="data"
            matSort
            (matSortChange)="onSortChange($event)"
            class="mat-elevation-z2">

            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef mat-sort-header="Name">Name</th>
              <td mat-cell *matCellDef="let row">{{ row.name }}</td>
            </ng-container>

            <ng-container matColumnDef="surname">
              <th mat-header-cell *matHeaderCellDef mat-sort-header="Surname">Surname</th>
              <td mat-cell *matCellDef="let row">{{ row.surname }}</td>
            </ng-container>

            <ng-container matColumnDef="email">
              <th mat-header-cell *matHeaderCellDef mat-sort-header="Email">Email</th>
              <td mat-cell *matCellDef="let row">{{ row.email }}</td>
            </ng-container>

            <ng-container matColumnDef="status">
              <th mat-header-cell *matHeaderCellDef>Status</th>
              <td mat-cell *matCellDef="let row">
                <mat-chip-listbox>
                  <mat-chip *ngIf="row.isActive" class="chip-success" matTooltip="Customer is active">
                    Active
                  </mat-chip>
                  <mat-chip *ngIf="!row.isActive" class="chip-error" matTooltip="Customer is inactive">
                    Inactive
                  </mat-chip>
                </mat-chip-listbox>
              </td>
            </ng-container>

            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef>Actions</th>
              <td mat-cell *matCellDef="let row">
                <button
                  mat-icon-button
                  color="primary"
                  matTooltip="View Customer"
                  (click)="navigateToCustomerViewPage(row.id)">
                  <mat-icon>visibility</mat-icon>
                </button>
                <button
                  mat-icon-button
                  color="primary"
                  matTooltip="Edit Customer"
                  (click)="editCustomer(row.id)">
                  <mat-icon>edit</mat-icon>
                </button>
                <button
                  mat-icon-button
                  color="warn"
                  matTooltip="Delete Customer"
                  (click)="deleteCustomer(row.id)"
                  [disabled]="isLoading">
                  <mat-icon>delete</mat-icon>
                </button>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

            <tr class="mat-row" *ngIf="!isLoading && data.length === 0">
              <td class="mat-cell" [attr.colspan]="displayedColumns.length">
                No customers found.
              </td>
            </tr>
          </table>

          <div class="loading-overlay" *ngIf="isLoading">
            <mat-spinner diameter="40"></mat-spinner>
          </div>
        </div>

        <mat-paginator
          [length]="totalItems"
          [pageSize]="pageSize"
          [pageIndex]="pageIndex"
          [pageSizeOptions]="[10, 25, 50, 100]"
          (page)="onPageChange($event)">
        </mat-paginator>
      </div>
    </mat-card-content>
  </mat-card>
</div>
